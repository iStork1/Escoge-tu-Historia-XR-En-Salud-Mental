{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Decision Telemetry Payload",
  "description": "Telemetry payload for XR story decision events",
  "type": "object",
  "required": ["session_id", "decision_id", "timestamp", "payload"],
  "properties": {
    "session_id": {
      "type": "string",
      "format": "uuid",
      "description": "UUID of the user's session"
    },
    "decision_id": {
      "type": "string",
      "format": "uuid",
      "description": "UUID of this decision event"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of decision"
    },
    "pseudonym": {
      "type": "string",
      "minLength": 1,
      "maxLength": 64,
      "description": "User's pseudonym (optional, for non-anonymous tracking)"
    },
    "device_id": {
      "type": "string",
      "maxLength": 128,
      "description": "Device identifier (Alexa, mobile, web, etc.)"
    },
    "payload": {
      "type": "object",
      "required": ["chapter_id", "scene_id", "option_id"],
      "properties": {
        "chapter_id": {
          "type": "string",
          "pattern": "^c[0-9]+$",
          "description": "Chapter identifier (format: c01, c02, etc.)"
        },
        "scene_id": {
          "type": "string",
          "pattern": "^c[0-9]+-s[0-9]+$",
          "description": "Scene identifier (format: c01-s01, c01-s02, etc.)"
        },
        "option_id": {
          "type": "string",
          "pattern": "^c[0-9]+-s[0-9]+-o[0-9]+$",
          "description": "Option/choice identifier (format: c01-s01-o1, etc.)"
        },
        "option_text": {
          "type": "string",
          "maxLength": 512,
          "description": "Text of the chosen option"
        },
        "consequence": {
          "type": "string",
          "maxLength": 1024,
          "description": "Narrative consequence/outcome of the choice"
        },
        "time_to_decision_ms": {
          "type": "integer",
          "minimum": 0,
          "maximum": 600000,
          "description": "Time in milliseconds user spent deciding"
        },
        "metadata": {
          "type": "object",
          "additionalProperties": true,
          "description": "Additional metadata about the decision"
        }
      },
      "additionalProperties": false
    },
    "llm_request": {
      "type": "object",
      "description": "LLM mapping request (optional, for clinician mapping)"
    },
    "llm_response": {
      "type": "object",
      "description": "LLM mapping response (optional, for clinician mapping)"
    },
    "context": {
      "type": "object",
      "properties": {
        "previous_chapter_id": {
          "type": "string"
        },
        "user_state": {
          "type": "object"
        }
      },
      "description": "Context information about the session"
    }
  },
  "additionalProperties": false
}
