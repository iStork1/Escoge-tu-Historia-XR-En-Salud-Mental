# Biblia del Juego — Telemetría y Diseño

> Documento maestro (GitHub Wiki) que define la experiencia del usuario, telemetría mínima, métricas de detección y el uso en Alexa.

## Introducción
"Escoje tu Historia" es una experiencia narrativa interactiva diseñada para adultos mayores que combina ficción inmersiva con mapeo clínico indirecto. El jugador avanza por capítulos y toma decisiones en escenas; esas elecciones se mapean (de forma estructurada y con consentimiento) a ítems de escalas clínicas (GDS‑15 y PHQ‑9) para detectar señales tempranas de riesgo emocional.

- Público objetivo: adultos mayores, cuidadores y clínicos que supervisan programas de salud mental preventiva.
- Objetivo del juego: ofrecer una experiencia agradable y no intrusiva que también permita la recolección de señales conductuales y emocionales para detección temprana y seguimiento.

## Propósito
- Público: product manager, diseñador narrativo, clínico responsable, desarrollador backend.
- Objetivo: documentar qué puede y debe hacer el usuario, límites del juego y telemetría necesaria para detección clínica no intrusiva.

---

## 1. Guía rápida para el usuario (qué puede / no puede hacer)
- El usuario puede: elegir opciones en escenas, pausar/reanudar, pedir aclaraciones al narrador, aceptar/rechazar registro de datos y solicitar ayuda.
- El usuario no debe: recibir preguntas clínicas directas sin consentimiento; el sistema no diagnostica ni da consejos clínicos automáticos.
- Consentimiento: se solicita vocalmente antes de almacenar metadatos; el usuario puede revocar en cualquier momento.
- Modos de privacidad: `Anónimo` (solo métricas agregadas) o `Con seguimiento` (registro `decision_audit`).

---

## 2. Cómo abrir y jugar en Alexa
1. Activa la Skill en la app de Alexa o publica en la consola de Alexa Skills.
2. Invocación por voz (ejemplos):
   - "Alexa, abre Escoje tu Historia"
   - "Alexa, abre Escoje tu Historia XR"
3. Flujo inicial:
   - Alexa: saludo breve + aviso de consentimiento.
   - Usuario: responde (aceptar / rechazar). Si acepta → comienza el capítulo 1.
4. Interacción por capítulo:
   - Alexa narra la escena y lee 3 opciones.
   - Usuario elige (por voz). Alexa confirma y registra la `option_id`.
   - Al finalizar un capítulo, Alexa ofrece un resumen y la opción de pausar o continuar.
5. Comandos útiles del usuario:
   - "Pausa" / "Continuar"
   - "Repite la opción 2"
   - "¿Qué se registra?" → Alexa resume datos guardados y cómo revocar consentimiento.

---

## 3. Ejemplo de juego (mini‑escena)
Escena: "La cocina silenciosa"
- Narrador: "Entras a una cocina donde la radio está apagada. En la mesa hay una carta y una taza de té frío. ¿Qué haces?"
- Opciones:
  1) "Leer la carta" → mapping: GDS:item_3 (pérdida de interés), weight=0.6
  2) "Calentar el té" → mapping: PHQ:item_5 (cambios en apetito), weight=0.2
  3) "Salir de la cocina" → mapping: none/confidence=0.2

Comportamiento:
- El sistema registra `choice`, `time_to_decision_ms` y el `decision_rationale` (scale,item,weight,confidence).
- Si PHQ‑9#9 se activa por la elección o la narración → emitir `RISK_FLAG` y escalar.

---

## 4. Telemetría (qué se registrará, resumen)
- Datos de sesión: `session_id` (pseudonimizado), `timestamp`, `chapter_id`, `scene_id`, `option_id`, `decision_rationale`, `time_to_decision_ms`, `abandonment_flag`, `session_length_seconds`.
- Opcional (con consentimiento): `response_audio_metrics` (valencia, arousal, tristeza), `pause_durations_ms`.
- Agregados longitudinales: `frequency_of_use`, `avg_time_per_session`, `trend_emotional_score`.
- Eventos críticos: `RISK_FLAG`, `manual_review_requested`.

---

## 5. Métricas clave (resumen)
- Primarias: `emotional_score_accumulated` (por GDS/PHQ), `phq9_item9_risk_score`, `mapping_confidence_mean`.
- Secundarias: `time_to_decision_mean`, `hesitation_rate`, `abandonment_rate`, `option_entropy`, `sentiment_score`.
- Correlación post‑pilot: `pearson_gds_correlation`, `pearson_phq_correlation`.

---

## 6. Tabla de métricas (uso rápido)
| Métrica | Tipo | Recolección | Uso |
|---|---:|---|---|
| emotional_score_accumulated | float | por opción, agregado por sesión | Señal primaria; alertas y reportes |
| phq9_item9_risk_score | float | evento por opción | Si >= threshold → `RISK_FLAG` y escalado humano |
| mapping_confidence_mean | float (0–1) | por sesión | Control de calidad; si baja → marcar `uncertain` y revisión |
| abrupt_change_flag | bool | serie temporal | Detecta deterioro rápido entre sesiones/capítulos |
| time_to_decision_mean | float (ms) | por sesión | Señal de indecisión/fatiga |
| hesitation_rate | float | por opción | Pausas o vacilaciones; indicador de ansiedad/rumiación |
| abandonment_rate | float (0–1) | agregado | Indica fricción o disconfort; alta tasa necesita investigación |
| frequency_of_use | int/float | agregado por usuario | Cambios abruptos pueden indicar episodios o mejora |
| option_entropy | float | por capítulo | Mide diversidad de elecciones; baja entropía puede implicar patrón rígido |
| sentiment_score | float (-1..1) | por opción | Contribuye a `emotional_score_accumulated` y tendencias |

Notas: audio/voz requiere consentimiento explícito; guardar solo pseudónimos.

Notas: audio/voz requiere consentimiento explícito; guardar solo pseudónimos.

---

## 7. Umbrales, alertas y escalado
- `default_confidence_threshold = 0.6` (si confidence < threshold → `uncertain`).
- `phq9_item9_risk_threshold = 0.2` (weight*confidence >= threshold → `RISK_FLAG`).
- `abrupt_change` si delta > max(2σ, 30% relativo).
- `RISK_FLAG` → crear `decision_audit`, notificar revisor clínico, suspender automatismos.

---

## 8. Integración técnica mínima (para desarrolladores)
- `decision_audit` schema: `{id, session_id, timestamp, chapter_id, scene_id, option_id, mapping:{scale,item,weight,confidence}, validation:[heuristic_checks], risk_flags:[], pseudonym}`.
- Endpoints: `POST /telemetry`, `GET /reports`, `POST /manual_review`.
- Requisitos Alexa: la Skill debe pedir consentimiento en el primer inicio y ofrecer comandos de privacidad.

---

## 9. Ejemplo rápido de `decision_audit` (JSON)
```
{
  "id": "audit_0001",
  "session_id": "sess_abc123",
  "timestamp": "2026-02-07T10:15:30Z",
  "chapter_id": "cap1",
  "scene_id": "cocina_silenciosa",
  "option_id": "leer_carta",
  "mapping": {"scale":"GDS","item":"item_3","weight":0.6,"confidence":0.78},
  "validation": ["confidence>=0.6"],
  "risk_flags": [],
  "pseudonym": "user_9f3b"
}
```


## Créditos y responsabilidades
- Autor: Felipe Jaimes Meza
- Mantener: equipo de producto / equipo clínico.


